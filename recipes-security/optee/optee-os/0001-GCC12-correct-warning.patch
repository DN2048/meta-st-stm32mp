From a40d13672e84cc3c849465cb8749d43b066f830f Mon Sep 17 00:00:00 2001
From: Christophe Priouzeau <christophe.priouzeau@foss.st.com>
Date: Tue, 18 Oct 2022 14:16:30 +0200
Subject: [PATCH] GCC12: correct warning

Signed-off-by: Christophe Priouzeau <christophe.priouzeau@foss.st.com>
---
 core/arch/arm/kernel/link.mk       | 3 ++-
 core/arch/arm/plat-stm32mp1/main.c | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/core/arch/arm/kernel/link.mk b/core/arch/arm/kernel/link.mk
index 51808b80c..03a51258a 100644
--- a/core/arch/arm/kernel/link.mk
+++ b/core/arch/arm/kernel/link.mk
@@ -23,7 +23,8 @@ link-ldflags += $(call ld-option,-z force-bti) --fatal-warnings
 endif
 link-ldflags += -T $(link-script-pp) -Map=$(link-out-dir)/tee.map
 link-ldflags += --sort-section=alignment
-link-ldflags += --fatal-warnings
+#link-ldflags += --fatal-warnings
+link-ldflags += --no-warn-rwx-segment
 link-ldflags += --gc-sections
 
 link-ldadd  = $(LDADD)
diff --git a/core/arch/arm/plat-stm32mp1/main.c b/core/arch/arm/plat-stm32mp1/main.c
index eecd4fe0b..878ae4df6 100644
--- a/core/arch/arm/plat-stm32mp1/main.c
+++ b/core/arch/arm/plat-stm32mp1/main.c
@@ -164,9 +164,9 @@ static TEE_Result init_console_from_dt(void)
 	/* Replace early console with the new one */
 	console_flush();
 	console_data = *pd;
+	IMSG("DTB enables console (%ssecure)", pd->secure ? "" : "non-");
 	free(pd);
 	register_serial_console(&console_data.chip);
-	IMSG("DTB enables console (%ssecure)", pd->secure ? "" : "non-");
 
 	return TEE_SUCCESS;
 }
-- 
2.25.1

